@model VeganProfileAddVM
@{ ViewBag.Title = "Add";}
@{
    Layout = "_ProfileLayout";
}

@section styles
{
    <link rel="stylesheet" type="text/css" href="~/Styles/Addrecipe.css">
}

<div class="contentRec">
    <div class="add-recipe-loop">

        <div id="RecipeLoop-item-1" class="RecipeLoop-item">
            <h2>Step 1 </h2> </br>

            <label asp-for="Name" for="input"></label>
            </br>
            <input id="input" class="form-control" type="text" />
            </br>

            @foreach (var item in Model.Categories)
            {
                <div class="form-check form-check-inline">
                    <input type="checkbox" name="ingredient" value="@item.Value" checked>@item.Text<br />
                </div>
            }

            </br>

            <form method="post" enctype="multipart/form-data">
                </br>

                <input id="profilePic" name="picture" type="file" size="1" />
            </form>



            <button id="btnPosition" onclick="uploadFile();" data-item-to-show="2" class="btn btn-outline-success">Next</button>
        </div>


        <div id="RecipeLoop-item-2" class="RecipeLoop-item hide">
            <div class="d-flex flex-row">
                <div class="ContainerforMuch">
                    <h2>Step 2</h2> </br>

                    <label>Ingredient</label>
                    </br>
                    <input id="IngrInput" />

                    </br>
                    <label>Amount</label>
                    </br>
                    <input id="AmountInput" type="number" />

                    @*<label asp-for="MeasurementItems"></label>*@
                    <select asp-for="SelectedMeasurementValue"
                            asp-items="Model.MeasurementItems" id="valueofDD"></select>
                    <span asp-validation-for="SelectedMeasurementValue"></span>
                    </br>
                    <div class="paddingForBtn">
                        <button type="button" onclick="AddIngredients();" data-item-to-show="2" class="btn btn-success"> Add ingredient</button>
                    </div>

                </div>
                <div id="ingredientContainer">
                    <ul id="ingredientsList">
                        <li>Tillagda ingredienser: </li>
                    </ul>

                </div>
            </div>

            <button type="button" data-item-to-show="1" class="btn btn-outline-secondary" id="btnLeft">Back</button>
            <button type="button" data-item-to-show="3" class="btn btn-outline-success" id="btnPosition">Next</button>



        </div>

        <div id="RecipeLoop-item-3" class="RecipeLoop-item hide">
            <h2>Step 3</h2>
            <div class="form-group shadow-textarea">
                <label>Recipe description</label>
                </br>
                <textarea id="RecipeDescr" class="form-control z-depth-1" rows="13" placeholder="Write something here..."></textarea>
                </br>
            </div>

            <button type="button" data-item-to-show="2" class="btn btn-outline-secondary" id="btnLeft">Back</button>
            <button type="button" data-item-to-show="3" onclick="AddDescription();" class="btn btn-outline-success" id="btnPosition">Publish</button>


        </div>

        @*<div id="RecipeLoop-item-4" class="RecipeLoop-item hide">
                Preview
                <button type="button" data-item-to-show="3" class="btn btn-outline-secondary" id="btnLeft">Back</button>
                <input type="submit" value="Publish" />


            </div>*@


    </div>
</div>



@section scripts
{
    <script src="~/Scripts/JavaScript.js" type="text/javascript"></script>

    <script>

        var recepieId = 0;
        var IngID = 0;

        function uploadFile() {
            var categoryIDs = [];

            $.each($("input[name='ingredient']:checked"), function () {
                categoryIDs.push($(this).val());
            });

            var DishName = $('#input').val();

            var fileUpload = $("#profilePic").get(0);
            var files = fileUpload.files;
            var formData = new FormData();
            formData.append('file', files[0]);
            formData.append('categoryIDs', categoryIDs);
            formData.append('recepieId', recepieId);
            formData.append('title', DishName);

            $.ajax({
                url: '/AddRecipieStep1',
                type: 'POST',
                data: formData,
                processData: false,
                contentType: false,
                success: function (result) {
                    recepieId = result;
                }
            });

            //$.ajax({
            //    url: '/CreateRecipe',
            //    type: 'POST',
            //    contentType: "application/json",
            //    data: JSON.stringify({ categoryIDs: categoryIDs }),
            //    success: function (result) {



            //    }

            //});

        };

        function AddIngredients() {
            var IngredientName = $('#IngrInput').val();
            var IngredientAmount = $('#AmountInput').val();
            var DDValue = $('#valueofDD').val();
            var CurrentID = recepieId;

            var formData = new FormData();
            formData.append('RecipeIngr', IngredientName);
            formData.append('RecipeAmount', IngredientAmount);
            formData.append('DropDownVal', DDValue);
            formData.append('RecID', CurrentID);

            $.ajax({
                url: '/AddRecipieStep2',
                type: 'POST',
                data: formData,
                processData: false,
                contentType: false,
                success: function (result) {
                    IngID = result;
                    $("#ingredientContainer ul li:last").after(
                        '<li id="' + IngID + '">' + IngredientName + " " + IngredientAmount + " " + DDValue + " "
                        + '<a href="javascript:deleteIngredient(' + IngID + ')"><i class="fas fa-trash-alt"></i></a>' + '</li>');
                    $("#IngrInput").val("");
                    $("#AmountInput").val("");

                }
            });
        }

        function AddDescription() {
            var Description = $('#RecipeDescr').val();
            var idOfRec = recepieId;
            var formData = new FormData();
            formData.append('TextBox', Description);
            formData.append('RecID', idOfRec);

            $.ajax({
                url: '/AddRecipieStep3',
                type: 'POST',
                data: formData,
                processData: false,
                contentType: false,
                success: function (result) {
                    alert("Recipe is now saved");
                }
            });
        }



        //function uploadFile(inputId) {
        //    var categoryIDs = [];

        //    $.each($("input[name='ingredient']:checked"), function () {
        //        categoryIDs.push($(this).val());
        //    });
        //    $.ajax({
        //        url: '/Posting',
        //        type: 'POST',
        //        contentType: "application/json",
        //        data: JSON.stringify({categoryIDs: categoryIDs }),
        //        success: function (result) {
        //        }
        //    });
        //};





        //var fileUpload = $("#" + inputId).get(0);
        //var files = fileUpload.files;
        //var formData = new FormData();
        //formData.append('file', files[0]);

        //$.ajax({
        //    url: '/Image/File',
        //    type: 'POST',
        //    data: formData,
        //    processData: false,
        //    contentType: false,
        //    success: function (result) {
        //    }
        //});

        function deleteIngredient(IngID) {
            var formData = new FormData();
            formData.append('CurrentIngID', IngID);

            $.ajax({
                url: '/DeleteIngredient',
                type: 'POST',
                data: formData,
                processData: false,
                contentType: false,
                success: function (result) {
                }
            });

            $('#' + IngID).remove();

        }

    </script>
}